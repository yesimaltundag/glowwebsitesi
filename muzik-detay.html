<!DOCTYPE html>
<html lang="tr" ng-app="GirisApp">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M√ºzik Detay - GLOW</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="assets/js/app.js"></script>
    <style>
      .muzik-detay-container {
        max-width: 100%;
        margin: 40px auto;
        padding: 32px 40px;
        background: var(--card-bg, rgba(255, 255, 255, 0.92));
        border-radius: 18px;
        box-shadow: 0 8px 32px var(--shadow-color, rgba(124, 92, 74, 0.1));
        backdrop-filter: blur(10px);
        position: relative;
        width: 100%;
        border: 1px solid var(--border-color, rgba(124, 92, 74, 0.1));
      }
      .muzik-detay-header {
        text-align: center;
        margin-bottom: 40px;
      }
      .muzik-detay-baslik {
        color: var(--text-primary, #7c5c4a);
        font-size: 2.5rem;
        font-weight: 700;
        letter-spacing: 2px;
        margin-bottom: 16px;
        text-shadow: 0 2px 4px var(--shadow-color, rgba(124, 92, 74, 0.1));
      }
      .muzik-detay-aciklama {
        color: var(--text-secondary, #b48a78);
        font-size: 1.1rem;
        font-weight: 500;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.6;
      }
      .muzik-tur-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        display: block;
        filter: drop-shadow(0 4px 8px var(--shadow-color, rgba(124, 92, 74, 0.3)));
      }
      .sarki-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 24px;
        margin-top: 32px;
      }
      .sarki-card {
        background: var(--card-bg, linear-gradient(135deg, #f8e0e1 60%, #e2d9d0 100%));
        border-radius: 16px;
        box-shadow: 0 4px 16px var(--shadow-color, rgba(180, 138, 120, 0.08));
        padding: 24px;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        gap: 20px;
        border: 1px solid var(--border-color, rgba(180, 138, 120, 0.1));
      }
      .sarki-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px var(--shadow-color, rgba(180, 138, 120, 0.2));
      }
      .sarki-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--text-secondary, #b48a78), var(--border-color, #e2d9d0));
      }
      .sarki-icon {
        width: 80px;
        height: 80px;
        border-radius: 12px;
        object-fit: cover;
        box-shadow: 0 4px 12px var(--shadow-color, rgba(124, 92, 74, 0.2));
        flex-shrink: 0;
        transition: transform 0.3s ease;
      }
      .sarki-card:hover .sarki-icon {
        transform: scale(1.05);
      }
      .sarki-bilgi {
        flex: 1;
      }
      .sarki-baslik {
        color: var(--text-primary, #7c5c4a);
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 8px;
        line-height: 1.3;
      }
      .sarki-sanatci {
        color: var(--text-secondary, #b48a78);
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 6px;
      }
      .sarki-album {
        color: var(--text-secondary, #999);
        font-size: 0.9rem;
        margin-bottom: 12px;
      }
      .sarki-ozellikler {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .sarki-ozellik {
        background: var(--bg-secondary, rgba(255, 255, 255, 0.8));
        color: var(--text-secondary, #b48a78);
        padding: 4px 10px;
        border-radius: 16px;
        font-size: 0.75rem;
        font-weight: 500;
        border: 1px solid var(--border-color, rgba(180, 138, 120, 0.2));
      }
      .geri-btn {
        background: linear-gradient(135deg, var(--button-bg, #e2d9d0), var(--text-secondary, #b48a78));
        color: var(--text-primary, #7c5c4a);
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        padding: 0;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        position: absolute;
        top: 20px;
        left: 20px;
        margin: 0;
        box-shadow: 0 4px 12px var(--shadow-color, rgba(0, 0, 0, 0.1));
      }
      .geri-btn:hover {
        background: linear-gradient(135deg, var(--text-secondary, #b48a78), var(--button-bg, #e2d9d0));
        color: var(--bg-primary, #fff);
        transform: scale(1.1);
        box-shadow: 0 6px 16px var(--shadow-color, rgba(0, 0, 0, 0.2));
      }

      /* Dark mode √∂zel stilleri */
      body.dark-theme .muzik-detay-container {
        background: rgba(44, 44, 44, 0.95);
        border-color: rgba(64, 64, 64, 0.3);
      }

      body.dark-theme .sarki-card {
        background: linear-gradient(135deg, rgba(64, 64, 64, 0.8) 60%, rgba(52, 52, 52, 0.9) 100%);
        border-color: rgba(64, 64, 64, 0.4);
      }

      body.dark-theme .sarki-card:hover {
        background: linear-gradient(135deg, rgba(80, 80, 80, 0.9) 60%, rgba(64, 64, 64, 1) 100%);
        border-color: rgba(96, 96, 96, 0.6);
      }

      body.dark-theme .sarki-ozellik {
        background: rgba(64, 64, 64, 0.8);
        color: #b0b0b0;
        border-color: rgba(96, 96, 96, 0.4);
      }

      body.dark-theme .geri-btn {
        background: linear-gradient(135deg, #404040, #606060);
        color: #ffffff;
        border: 1px solid rgba(96, 96, 96, 0.3);
      }

      body.dark-theme .geri-btn:hover {
        background: linear-gradient(135deg, #606060, #808080);
        border-color: rgba(128, 128, 128, 0.5);
      }

      /* Light mode √∂zel stilleri */
      body.light-theme .muzik-detay-container {
        background: rgba(255, 255, 255, 0.95);
        border-color: rgba(222, 226, 230, 0.3);
      }

      body.light-theme .sarki-card {
        background: linear-gradient(135deg, #f8e0e1 60%, #e2d9d0 100%);
        border-color: rgba(180, 138, 120, 0.1);
      }

      body.light-theme .sarki-card:hover {
        background: linear-gradient(135deg, #f0d4d5 60%, #d8c8c0 100%);
        border-color: rgba(180, 138, 120, 0.2);
      }

      body.light-theme .sarki-ozellik {
        background: rgba(255, 255, 255, 0.8);
        color: #b48a78;
        border-color: rgba(180, 138, 120, 0.2);
      }

      @media (max-width: 768px) {
        .muzik-detay-container {
          padding: 20px;
          margin: 20px;
        }
        .muzik-detay-baslik {
          font-size: 2rem;
        }
        .sarki-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }
        .geri-btn {
          width: 45px;
          height: 45px;
          font-size: 18px;
        }
      }
      @media (max-width: 600px) {
        .muzik-detay-container {
          padding: 20px;
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <ng-include src="'components/header.html'"></ng-include>
    <main class="main-content">
      <div class="muzik-detay-container" ng-controller="MuzikDetayController">
        <button
          class="geri-btn"
          ng-click="geriDon()"
          title="M√ºzik T√ºrleri'ne D√∂n"
        >
          ‚Üê
        </button>
        <div class="muzik-detay-header">
          <span class="muzik-tur-icon">{{seciliTur.icon}}</span>
          <h1 class="muzik-detay-baslik">{{seciliTur.ad}} ≈ûarkƒ±larƒ±</h1>
          <p class="muzik-detay-aciklama">
            {{seciliTur.ad}} t√ºr√ºn√ºn en pop√ºler ve g√ºncel ≈üarkƒ±larƒ±nƒ± ke≈üfet!
          </p>
        </div>
        <div class="sarki-grid" ng-if="!loading && !error">
          <div
            class="sarki-card"
            ng-repeat="sarki in sarkilar"
            ng-click="sarkiSec(sarki)"
          >
            <img
              class="sarki-icon"
              ng-src="{{sarki.foto_url}}"
              alt="{{sarki.muzik_adi}}"
              onerror="this.src='https://via.placeholder.com/80x80/7c5c4a/ffffff?text=üéµ'"
            />
            <div class="sarki-bilgi">
              <h3 class="sarki-baslik">{{sarki.muzik_adi}}</h3>
              <p class="sarki-sanatci">{{sarki.sanatci}}</p>
              <p class="sarki-yil">
                {{sarki.yayin_yili}} ‚Ä¢ {{sarki.sure | saniyeToDakika}}
              </p>
              <p class="sarki-aciklama" ng-if="sarki.aciklama">
                {{sarki.aciklama}}
              </p>
            </div>
          </div>
        </div>

        <!-- Loading g√∂stergesi -->
        <div ng-if="loading" style="text-align: center; padding: 40px">
          <div style="font-size: 2rem; margin-bottom: 20px">üéµ</div>
          <div style="color: #7c5c4a; font-size: 1.2rem; font-weight: 600">
            ≈ûarkƒ±lar y√ºkleniyor...
          </div>
        </div>

        <!-- Hata mesajƒ± -->
        <div ng-if="error" style="text-align: center; padding: 40px">
          <div style="font-size: 2rem; margin-bottom: 20px">‚ùå</div>
          <div style="color: #7c5c4a; font-size: 1.2rem; font-weight: 600">
            {{error}}
          </div>
          <div style="color: #b48a78; font-size: 1rem; margin-top: 10px">
            L√ºtfen sayfayƒ± yenileyin veya daha sonra tekrar deneyin.
          </div>
        </div>
      </div>
    </main>
    <ng-include src="'components/footer.html'"></ng-include>
    <button id="scrollTopBtn" title="Yukarƒ± √áƒ±k" ng-click="scrollToTop()">
      ‚Üë
    </button>
    <script>
      angular
        .module("GirisApp")
        .controller(
          "MuzikDetayController",
          function ($scope, $location, $http) {
            $scope.kullanici = JSON.parse(
              localStorage.getItem("girisYapan") || "null"
            );

            // URL'den m√ºzik t√ºr√º ID'sini al
            const urlParams = new URLSearchParams(window.location.search);
            const turId = urlParams.get("tur");

            // M√ºzik t√ºrleri verileri
            const muzikTurleri = [
              {
                id: "klasik",
                ad: "Klasik",
                icon: "üéº",
              },
              {
                id: "jazz",
                ad: "Jazz",
                icon: "üé∑",
              },
              {
                id: "rock",
                ad: "Rock",
                icon: "üé∏",
              },
              {
                id: "pop",
                ad: "Pop",
                icon: "üé§",
              },
              {
                id: "folk",
                ad: "Folk",
                icon: "ü™ï",
              },
              {
                id: "elektronik",
                ad: "Elektronik",
                icon: "üéõÔ∏è",
              },
              {
                id: "blues",
                ad: "Blues",
                icon: "üéµ",
              },
              {
                id: "country",
                ad: "Country",
                icon: "ü§†",
              },
              {
                id: "reggae",
                ad: "Reggae",
                icon: "üå¥",
              },
              {
                id: "hiphop",
                ad: "Hip Hop",
                icon: "üéß",
              },
              {
                id: "world",
                ad: "World",
                icon: "üåç",
              },
              {
                id: "ambient",
                ad: "Ambient",
                icon: "üåå",
              },
            ];

            // Se√ßilen t√ºr√º bul
            $scope.seciliTur =
              muzikTurleri.find((tur) => tur.id === turId) || muzikTurleri[0];

            // Veritabanƒ±ndan ≈üarkƒ±larƒ± √ßek
            $scope.sarkilar = [];
            $scope.loading = true;
            $scope.error = null;

            // API'den ≈üarkƒ±larƒ± getir
            $http
              .get(
                "api.php?muzik=1&tur=" + encodeURIComponent($scope.seciliTur.ad)
              )
              .then(function (response) {
                console.log("üéµ API yanƒ±tƒ±:", response.data);
                $scope.sarkilar = response.data;
                $scope.loading = false;
              })
              .catch(function (error) {
                console.error("‚ùå API hatasƒ±:", error);
                $scope.error = "≈ûarkƒ±lar y√ºklenirken hata olu≈ütu";
                $scope.loading = false;

                // Hata durumunda statik verileri kullan
                const sarkiVerileri = {
                  "Klasik M√ºzik": [
                    {
                      baslik: "Moonlight Sonata",
                      sanatci: "Ludwig van Beethoven",
                      yil: "1801",
                      fotograf:
                        "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=80&h=80&fit=crop&crop=center",
                      aciklama:
                        "Beethoven'ƒ±n en √ºnl√º piyano sonatlarƒ±ndan biri. Ay ƒ±≈üƒ±ƒüƒ±nƒ±n g√∂lgelerini yansƒ±tan melankolik melodileriyle tanƒ±nƒ±r.",
                      sure: "14:39",
                      spotify_url:
                        "https://open.spotify.com/track/4CzN9rdDKNcyVNDpPIJh9L",
                    },
                  ],
                  Jazz: [
                    {
                      baslik: "Take Five",
                      sanatci: "Dave Brubeck Quartet",
                      yil: "1959",
                      fotograf:
                        "https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=80&h=80&fit=crop&crop=center",
                      sure: "5:24",
                      spotify_url:
                        "https://open.spotify.com/track/1YQWosTIljIvxAgHWTp7KP",
                    },
                  ],
                  Rock: [
                    {
                      baslik: "Bohemian Rhapsody",
                      sanatci: "Queen",
                      yil: "1975",
                      fotograf:
                        "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=80&h=80&fit=crop&crop=center",
                      sure: "5:54",
                      spotify_url:
                        "https://open.spotify.com/track/3z8h0TU7ReDPLIbEnYhWZb",
                    },
                  ],
                };

                $scope.sarkilar = sarkiVerileri[$scope.seciliTur.ad] || [];
              });

            $scope.sarkiSec = function (sarki) {
              // ≈ûarkƒ± bilgilerini localStorage'a kaydet
              localStorage.setItem("seciliSarki", JSON.stringify(sarki));
              // Sadece ≈üarkƒ± ID'sini URL'de g√∂nder (temiz URL)
              const sarkiId = sarki.muzik_adi
                .replace(/[^a-zA-Z0-9]/g, "-")
                .toLowerCase();
              window.location.href = "sarki-detay.html?id=" + sarkiId;
            };

            $scope.geriDon = function () {
              window.location.href = "muzik-turleri.html";
            };

            $scope.scrollToTop = function () {
              window.scrollTo({ top: 0, behavior: "smooth" });
            };
          }
        );
    </script>
  </body>
</html>
