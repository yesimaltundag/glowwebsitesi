<!DOCTYPE html>
<html lang="tr" ng-app="GirisApp">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Afrika Seyahatleri - GLOW</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="assets/js/app.js"></script>
  </head>
  <body>
    <ng-include src="'components/header.html'"></ng-include>

    <main class="main-content">
      <div class="afrika-container" ng-controller="AfrikaSeyahatController">
        <button class="geri-btn" ng-click="geriGit()" title="Geri Dön">
          ←
        </button>

        <div class="page-header">
          <h1 class="page-title">🦁 Afrika Seyahatleri</h1>
          <p class="page-subtitle">Afrika'nın En Ünlü Şehirleri</p>
        </div>

        <!-- Loading durumu -->
        <div ng-if="loading" class="loading">
          ✈️ Afrika seyahatleri yükleniyor...
        </div>

        <!-- Hata durumu -->
        <div ng-if="error" class="error">❌ {{error}}</div>

        <!-- Şehirler grid -->
        <div class="sehirler-grid" ng-if="!loading && !error">
          <div
            class="sehir-card"
            ng-repeat="sehir in afrikaSehirleri"
            ng-click="sehirDetayGit(sehir)"
            ng-style="{'background-image': 'url(' + sehir.foto + ')'}"
          >
            <div class="sehir-overlay">
              <h3 class="sehir-baslik">
                <span class="sehir-icon">{{sehir.icon}}</span>
                {{sehir.ad}}
              </h3>
              <p class="sehir-ulke">{{sehir.ulke}}</p>
              <p class="sehir-aciklama">{{sehir.aciklama}}</p>

              <button class="detay-btn">Detayları Gör</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <ng-include src="'components/footer.html'"></ng-include>

    <script>
      angular
        .module("GirisApp")
        .controller("AfrikaSeyahatController", function ($scope, $http) {
          $scope.kullanici = JSON.parse(
            localStorage.getItem("girisYapan") || "null"
          );

          $scope.afrikaSehirleri = [];
          $scope.loading = true;
          $scope.error = null;

          // Afrika seyahatlerini API'den yükle
          $http
            .get("seyahat_api.php?afrika=1")
            .then(function (response) {
              if (response.data.success) {
                $scope.afrikaSehirleri = response.data.seyahatler;
                console.log(
                  "Afrika seyahatleri yüklendi:",
                  $scope.afrikaSehirleri
                );
              } else {
                $scope.error = "Veriler yüklenirken hata oluştu";
                console.error("API Hatası:", response.data);
              }
              $scope.loading = false;
            })
            .catch(function (error) {
              $scope.error = "Bağlantı hatası oluştu";
              console.error("HTTP Hatası:", error);
              $scope.loading = false;
            });

          // Geri tuşu fonksiyonu
          $scope.geriGit = function () {
            console.log("Afrika seyahatleri sayfasından geri tuşu");
            window.location.href = "seyahat.html";
          };

          // TAMAMEN YENİ FONKSİYON - Cache sorununu çözmek için
          $scope.sehirDetayGit = function (sehir) {
            console.log("=== YENİ FONKSİYON ÇALIŞIYOR ===");
            console.log("Seçilen şehir:", sehir);

            // LocalStorage'ı temizle
            localStorage.removeItem("seciliSehir");

            // Yeni şehir bilgisini kaydet
            localStorage.setItem("seciliSehir", JSON.stringify(sehir));

            // URL parametresi ile sehir-detay.html'e yönlendir
            var sehirAdi = sehir.ad.toLowerCase().replace(/\s+/g, "-");
            console.log(
              "sehir-detay.html?sehir=" +
                sehirAdi +
                " sayfasına yönlendiriliyor..."
            );
            window.location.replace("sehir-detay.html?sehir=" + sehirAdi);
          };
        });
    </script>
  </body>
</html>
