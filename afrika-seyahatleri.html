<!DOCTYPE html>
<html lang="tr" ng-app="GirisApp">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Afrika Seyahatleri - GLOW</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="assets/js/app.js"></script>
  </head>
  <body>
    <ng-include src="'components/header.html'"></ng-include>

    <main class="main-content">
      <div class="afrika-container" ng-controller="AfrikaSeyahatController">
        <button class="geri-btn" ng-click="geriGit()" title="Geri DÃ¶n">
          â†
        </button>

        <div class="page-header">
          <h1 class="page-title">ğŸ¦ Afrika Seyahatleri</h1>
          <p class="page-subtitle">Afrika'nÄ±n En ÃœnlÃ¼ Åehirleri</p>
        </div>

        <!-- Loading durumu -->
        <div ng-if="loading" class="loading">
          âœˆï¸ Afrika seyahatleri yÃ¼kleniyor...
        </div>

        <!-- Hata durumu -->
        <div ng-if="error" class="error">âŒ {{error}}</div>

        <!-- Åehirler grid -->
        <div class="sehirler-grid" ng-if="!loading && !error">
          <div
            class="sehir-card"
            ng-repeat="sehir in afrikaSehirleri"
            ng-click="sehirDetayGit(sehir)"
            ng-style="{'background-image': 'url(' + sehir.foto + ')'}"
          >
            <div class="sehir-overlay">
              <h3 class="sehir-baslik">
                <span class="sehir-icon">{{sehir.icon}}</span>
                {{sehir.ad}}
              </h3>
              <p class="sehir-ulke">{{sehir.ulke}}</p>
              <p class="sehir-aciklama">{{sehir.aciklama}}</p>

              <button class="detay-btn">DetaylarÄ± GÃ¶r</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <ng-include src="'components/footer.html'"></ng-include>

    <script>
      angular
        .module("GirisApp")
        .controller("AfrikaSeyahatController", function ($scope, $http) {
          $scope.kullanici = JSON.parse(
            localStorage.getItem("girisYapan") || "null"
          );

          $scope.afrikaSehirleri = [];
          $scope.loading = true;
          $scope.error = null;

          // Afrika seyahatlerini API'den yÃ¼kle
          $http
            .get("seyahat_api.php?afrika=1")
            .then(function (response) {
              if (response.data.success) {
                $scope.afrikaSehirleri = response.data.seyahatler;
                console.log(
                  "Afrika seyahatleri yÃ¼klendi:",
                  $scope.afrikaSehirleri
                );
              } else {
                $scope.error = "Veriler yÃ¼klenirken hata oluÅŸtu";
                console.error("API HatasÄ±:", response.data);
              }
              $scope.loading = false;
            })
            .catch(function (error) {
              $scope.error = "BaÄŸlantÄ± hatasÄ± oluÅŸtu";
              console.error("HTTP HatasÄ±:", error);
              $scope.loading = false;
            });

          // Geri tuÅŸu fonksiyonu
          $scope.geriGit = function () {
            console.log("Afrika seyahatleri sayfasÄ±ndan geri tuÅŸu");
            window.location.href = "seyahat.html";
          };

          // TAMAMEN YENÄ° FONKSÄ°YON - Cache sorununu Ã§Ã¶zmek iÃ§in
          $scope.sehirDetayGit = function (sehir) {
            console.log("=== YENÄ° FONKSÄ°YON Ã‡ALIÅIYOR ===");
            console.log("SeÃ§ilen ÅŸehir:", sehir);

            // LocalStorage'Ä± temizle
            localStorage.removeItem("seciliSehir");

            // Yeni ÅŸehir bilgisini kaydet
            localStorage.setItem("seciliSehir", JSON.stringify(sehir));

            // URL parametresi ile sehir-detay.html'e yÃ¶nlendir
            var sehirAdi = sehir.ad.toLowerCase().replace(/\s+/g, "-");
            console.log(
              "sehir-detay.html?sehir=" +
                sehirAdi +
                " sayfasÄ±na yÃ¶nlendiriliyor..."
            );
            window.location.replace("sehir-detay.html?sehir=" + sehirAdi);
          };
        });
    </script>
  </body>
</html>
